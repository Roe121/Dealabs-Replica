{% extends 'base.html.twig' %}

{% block title %}Liste des Deals
{% endblock %}

{% block body %}
	<div class="container my-5">
		<h1 class="text-center mb-4">ðŸ”¥ Les Meilleurs Deals ðŸ”¥</h1>

		<div class="mb-4 text-center">
			<a href="{{ path('deal_list', {'filter': 'all'}) }}" class="btn {{ filter == 'all' ? 'btn-secondary' : 'btn-outline-secondary' }} mx-1">Tous les Deals</a>
			<a href="{{ path('deal_list', {'filter': 'enabled'}) }}" class="btn {{ filter == 'enabled' ? 'btn-success' : 'btn-outline-success' }} mx-1">ActivÃ©s</a>
			<a href="{{ path('deal_list', {'filter': 'disabled'}) }}" class="btn {{ filter == 'disabled' ? 'btn-danger' : 'btn-outline-danger' }} mx-1">DÃ©sactivÃ©s</a>
		</div>

		{% if deals is not empty %}
			<div class="row g-4">
				{% for deal in deals %}
					<div class="col-md-4">
						<div class="card h-100 shadow-sm border-0">
							<div class="card-body d-flex flex-column justify-content-between">
								<h5 class="card-title">{{ deal.name }}</h5>

								<p class="card-text text-muted small">
									{{ deal.description|length > 100 ? deal.description[:100] ~ '...' : deal.description }}
								</p>

								<div class="mb-2">
									<strong class="text-danger fs-4">{{ deal.price }}
										â‚¬</strong>
								</div>

								<div class="d-flex justify-content-between align-items-center mb-2">
									<span class="badge {{ deal.enable ? 'bg-success' : 'bg-danger' }}">
										{{ deal.enable ? 'Actif' : 'Inactif' }}
									</span>

									<small class="text-muted">
										{% set now = date() %}
										{% set timeDiff = date(deal.createdAt).diff(now) %}

										{% if timeDiff.y > 0 %}
											PostÃ© il y a
											{{ timeDiff.y }}
											an{{ timeDiff.y > 1 ? 's' : '' }}
										{% elseif timeDiff.m > 0 %}
											PostÃ© il y a
											{{ timeDiff.m }}
											mois
										{% elseif timeDiff.d > 0 %}
											PostÃ© il y a
											{{ timeDiff.d }}
											jour{{ timeDiff.d > 1 ? 's' : '' }}
										{% elseif timeDiff.h > 0 %}
											PostÃ© il y a
											{{ timeDiff.h }}
											heure{{ timeDiff.h > 1 ? 's' : '' }}
										{% elseif timeDiff.i > 0 %}
											PostÃ© il y a
											{{ timeDiff.i }}
											minute{{ timeDiff.i > 1 ? 's' : '' }}
										{% else %}
											PostÃ© il y a quelques secondes
										{% endif %}
									</small>
								</div>

								<div class="mb-2">
									{% if deal.categories is not empty %}
										<small class="text-muted">CatÃ©gories:
											{% for category in deal.categories %}
												<span class="badge bg-info text-white">{{ category.name }}</span>
											{% endfor %}
										</small>
									{% else %}
										<small class="text-muted">Aucune catÃ©gorie</small>
									{% endif %}
								</div>

								<div class="mb-3 text-muted">
									<small class="text-muted">PopularitÃ©:</small>
									<!-- PopularitÃ© statique (flammes ðŸ”¥) -->
									<span class="text-warning">
										ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
									</span>
								</div>

								<button type="button" class="btn btn-outline-success w-50 mx-auto d-block" onclick="window.location.href='{{ path('deal_show', {'id': deal.id}) }}'">
									Voir le deal
									<i class="bi bi-box-arrow-up-right mx-1"></i>
								</button>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="alert alert-info text-center" role="alert">
				Aucun deal trouvÃ©.
			</div>
		{% endif %}
	</div>
{% endblock %}
