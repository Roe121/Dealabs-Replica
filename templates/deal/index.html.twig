{% extends 'base.html.twig' %}

{% block title %}Liste des Deals
{% endblock %}

{% block body %}
	<div class="container my-5">
		<h1 class="text-center mb-4">ðŸ”¥ Les Meilleurs Deals ðŸ”¥</h1>

		{% if deals is not empty %}
			<div class="row g-4">
				{% for deal in deals %}
					<div
						class="card shadow-sm border-0 p-3 d-flex flex-row align-items-center">
						<!-- Vote Box -->
						<div class="d-flex flex-column align-items-center me-3">
							<button class="btn btn-outline-danger btn-sm">â–²</button>
							<span class="fw-bold text-danger">{{ deal.hotScore }}</span>
							<button class="btn btn-outline-primary btn-sm">â–¼</button>
						</div>

						<!-- Image du deal -->
						<div class="me-3">
							<img src="{{ deal.image }}" alt="Deal Image" class="img-fluid rounded" style="width: 202px; height: 202px; object-fit: cover; border-radius: 12px;">
						</div>


						<!-- Contenu du deal -->
						<div class="flex-grow-1">
							<h5 class="mb-1">
								<a href="{{ path('deal_show', {'id': deal.id}) }}" class="text-black text-decoration-none">
									{{ deal.name }}
								</a>
							</h5>
							<p class="text-muted small mb-1">
								<s class="text-secondary">{{ deal.originalPrice }}â‚¬</s>
								<strong class="text-danger fs-5">{{ deal.price }}â‚¬</strong>
								<span class="badge bg-success">-{{ ((1 - (deal.price / deal.originalPrice)) * 100)|round }}%</span>
							</p>
							<p class="small text-muted mb-2">Vendu sur
								{{ deal.merchant.name }}</p>
							<p class="text-muted small mb-2">{{ deal.description|length > 100 ? deal.description[:100] ~ '...' : deal.description }}</p>

							<!-- Infos complÃ©mentaires -->
							<div class="d-flex align-items-center">
								<small class="me-3 text-muted">ðŸ’¬
									{{ deal.comments|length }}</small>
								<small class="me-3 text-muted">ðŸ”— PartagÃ© par
									{{ deal.user.username }}</small>

								{% set now = date() %}
								{% set timeDiff = date(deal.createdAt).diff(now) %}
								<small class="text-muted">
									{% if timeDiff.y > 0 %}
										PostÃ© il y a
										{{ timeDiff.y }}
										an{{ timeDiff.y > 1 ? 's' : '' }}
									{% elseif timeDiff.m > 0 %}
										PostÃ© il y a
										{{ timeDiff.m }}
										mois
									{% elseif timeDiff.d > 0 %}
										PostÃ© il y a
										{{ timeDiff.d }}
										jour{{ timeDiff.d > 1 ? 's' : '' }}
									{% elseif timeDiff.h > 0 %}
										PostÃ© il y a
										{{ timeDiff.h }}
										heure{{ timeDiff.h > 1 ? 's' : '' }}
									{% elseif timeDiff.i > 0 %}
										PostÃ© il y a
										{{ timeDiff.i }}
										minute{{ timeDiff.i > 1 ? 's' : '' }}
									{% else %}
										PostÃ© il y a quelques secondes
									{% endif %}
								</small>
							</div>
						</div>

						<!-- Bouton Voir le deal -->
						<div>
							<a href="{{ deal.dealUrl }}" target="_blank" class="btn btn-primary">Voir le deal ðŸ”—</a>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="alert alert-info text-center" role="alert">
				Aucun deal trouvÃ©.
			</div>
		{% endif %}
	</div>
{% endblock %}
